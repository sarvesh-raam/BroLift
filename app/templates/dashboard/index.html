{% extends "base.html" %}
{% block title %}Dashboard â€” BroLift{% endblock %}
{% block content %}
<div class="dashboard-page">
    <!-- Welcome Banner -->
    <div class="dashboard-header">
        <div class="welcome-text">
            <h1>Hey, {{ current_user.name.split()[0] }}! ğŸ‘‹</h1>
            <p>Here's your ride overview for today.</p>
        </div>
        <div class="dashboard-actions">
            {% if current_user.has_car %}
            <a href="{{ url_for('rides.host_ride') }}" class="btn-primary">ğŸš— Host a Ride</a>
            {% endif %}
            <a href="{{ url_for('rides.find_ride') }}" class="btn-secondary">ğŸ” Find a Ride</a>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">ğŸš—</div>
            <div class="stat-info">
                <div class="stat-value">{{ stats.rides_hosted }}</div>
                <div class="stat-label">Rides Hosted</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">ğŸ¤</div>
            <div class="stat-info">
                <div class="stat-value">{{ stats.rides_joined }}</div>
                <div class="stat-label">Rides Joined</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">â³</div>
            <div class="stat-info">
                <div class="stat-value">{{ stats.pending_requests }}</div>
                <div class="stat-label">Pending Requests</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">ğŸŒ±</div>
            <div class="stat-info">
                <div class="stat-value">{{ stats.rides_hosted + stats.rides_joined }}</div>
                <div class="stat-label">Eco Trips</div>
            </div>
        </div>
    </div>

    <!-- Upcoming Rides -->
    {% if upcoming %}
    <div class="dashboard-section">
        <h2 class="section-heading">ğŸ“… Upcoming Rides</h2>
        <div class="rides-list">
            {% for item in upcoming %}
            {% set ride = item.ride %}
            <div class="ride-card {% if item.type == 'host' %}ride-host{% else %}ride-passenger{% endif %}">
                <div class="ride-card-badge">{{ 'ğŸš— Hosting' if item.type == 'host' else 'ğŸ‘¤ Passenger' }}</div>
                <div class="ride-card-body">
                    <div class="ride-route">
                        <div class="route-from">ğŸ“ {{ ride.start_location[:40] }}</div>
                        <div class="route-arrow">â†’</div>
                        <div class="route-to">ğŸ« {{ ride.destination }}</div>
                    </div>
                    <div class="ride-meta">
                        <span class="meta-item">ğŸ• {{ ride.departure_time.strftime('%d %b, %I:%M %p') }}</span>
                        <span class="meta-item">ğŸ’º {{ ride.seats_available }} seats left</span>
                        <span class="meta-item">ğŸ’° â‚¹{{ ride.cost_per_person }}/person</span>
                        <span class="ride-badge status-{{ ride.status }}">{{ ride.status.upper() }}</span>
                    </div>
                </div>
                <a href="{{ url_for('rides.ride_detail', ride_id=ride.id) }}" class="ride-card-link">View â†’</a>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Two Column: Hosted + Joined -->
    <div class="dashboard-two-col">
        <!-- Hosted Rides -->
        <div class="dashboard-section">
            <h2 class="section-heading">ğŸš— My Hosted Rides</h2>
            {% if hosted_rides %}
            <div class="rides-list-compact">
                {% for ride in hosted_rides %}
                <div class="ride-item">
                    <div class="ride-item-info">
                        <div class="ride-item-route">{{ ride.start_location[:30] }} â†’ {{ ride.destination[:20] }}</div>
                        <div class="ride-item-time">{{ ride.departure_time.strftime('%d %b, %I:%M %p') }}</div>
                    </div>
                    <div class="ride-item-right">
                        <span class="ride-badge status-{{ ride.status }}">{{ ride.status }}</span>
                        <a href="{{ url_for('rides.ride_detail', ride_id=ride.id) }}" class="link-arrow">â†’</a>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-icon">ğŸš—</div>
                <p>No hosted rides yet.</p>
                {% if current_user.has_car %}
                <a href="{{ url_for('rides.host_ride') }}" class="btn-primary btn-sm">Host Your First Ride</a>
                {% else %}
                <a href="{{ url_for('auth.profile') }}" class="btn-secondary btn-sm">Add Your Car</a>
                {% endif %}
            </div>
            {% endif %}
        </div>

        <!-- Joined Rides -->
        <div class="dashboard-section">
            <h2 class="section-heading">ğŸ’ My Ride Requests</h2>
            {% if my_requests %}
            <div class="rides-list-compact">
                {% for req in my_requests %}
                <div class="ride-item">
                    <div class="ride-item-info">
                        <div class="ride-item-route">{{ req.ride.start_location[:30] }} â†’ College</div>
                        <div class="ride-item-time">{{ req.ride.departure_time.strftime('%d %b, %I:%M %p') }}</div>
                    </div>
                    <div class="ride-item-right">
                        <span class="ride-badge status-{{ req.status }}">{{ req.status }}</span>
                        <a href="{{ url_for('rides.ride_detail', ride_id=req.ride_id) }}" class="link-arrow">â†’</a>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-icon">ğŸ”</div>
                <p>No ride requests yet.</p>
                <a href="{{ url_for('rides.find_ride') }}" class="btn-secondary btn-sm">Find a Ride</a>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}